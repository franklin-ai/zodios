import ue,{AxiosError}from'axios';import te from'zod/v4';var _=Object.defineProperty,V=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var O=(o,e,t)=>e in o?_(o,e,{enumerable:true,configurable:true,writable:true,value:t}):o[e]=t,r=(o,e)=>{for(var t in e||(e={}))J.call(e,t)&&O(o,t,e[t]);if($)for(var t of $(e))W.call(e,t)&&O(o,t,e[t]);return o},a=(o,e)=>V(o,G(e));var l=(o,e,t)=>new Promise((i,n)=>{var s=f=>{try{d(t.next(f));}catch(c){n(c);}},h=f=>{try{d(t.throw(f));}catch(c){n(c);}},d=f=>f.done?i(f.value):Promise.resolve(f.value).then(s,h);d((t=t.apply(o,e)).next());});function b(o,e){let t=r({},o);for(let i of e)delete t[i];return t}function k(o){return o.charAt(0).toUpperCase()+o.slice(1)}var v=/:([a-zA-Z_][a-zA-Z0-9_]*)/g;function C(o){let e=o.url,t=o.params;return t&&(e=e.replace(v,(i,n)=>n in t?`${t[n]}`:i)),e}function g(o,e,t){return o.find(i=>i.method===e&&i.path===t)}function X(o,e){return o.find(t=>t.alias===e)}function I(o,e){var i,n;let t=(i=o.errors)==null?void 0:i.filter(s=>s.status===e.response.status);return t&&t.length>0?t:(n=o.errors)==null?void 0:n.filter(s=>s.status==="default")}function S(o,e,t,i){let n=g(o,e,t);return n&&i.config&&i.config.url&&n.method===i.config.method&&N(n.path,i.config.url)?I(n,i):void 0}function z(o,e,t){let i=X(o,e);return i&&t.config&&t.config.url&&i.method===t.config.method&&N(i.path,t.config.url)?I(i,t):void 0}function N(o,e){return new RegExp(`^${o.replace(v,()=>"([^/]*)")}$`).test(e)}function K(o){let e=new FormData;for(let t in o)e.append(t,o[t]);return {data:e}}var y=class extends Error{constructor(t,i,n,s){super(t);this.config=i;this.data=n;this.cause=s;}};var Y={name:"form-data",request:(o,e)=>l(null,null,function*(){if(typeof e.data!="object"||Array.isArray(e.data))throw new y("Zodios: multipart/form-data body must be an object",e);let t=K(e.data);return a(r({},e),{data:t.data,headers:r(r({},e.headers),t.headers)})})};function w(){return Y}var ee={name:"form-url",request:(o,e)=>l(null,null,function*(){if(typeof e.data!="object"||Array.isArray(e.data))throw new y("Zodios: application/x-www-form-urlencoded body must be an object",e);return a(r({},e),{data:new URLSearchParams(e.data).toString(),headers:a(r({},e.headers),{"Content-Type":"application/x-www-form-urlencoded"})})})};function D(){return ee}function x(o,e){return {request:(t,i)=>l(null,null,function*(){return a(r({},i),{headers:a(r({},i.headers),{[o]:e})})})}}function j(o){return [true,"response","all"].includes(o)}function U(o){return [true,"request","all"].includes(o)}function B({validate:o,transform:e,sendDefaults:t}){return {name:"zod-validation",request:U(o)?(i,n)=>l(null,null,function*(){let s=g(i,n.method,n.url);if(!s)throw new Error(`No endpoint found for ${n.method} ${n.url}`);let{parameters:h}=s;if(!h)return n;let d=a(r({},n),{queries:r({},n.queries),headers:r({},n.headers),params:r({},n.params)}),f={Query:p=>{var u;return (u=d.queries)==null?void 0:u[p]},Body:p=>d.data,Header:p=>{var u;return (u=d.headers)==null?void 0:u[p]},Path:p=>{var u;return (u=d.params)==null?void 0:u[p]}},c={Query:(p,u)=>d.queries[p]=u,Body:(p,u)=>d.data=u,Header:(p,u)=>d.headers[p]=u,Path:(p,u)=>d.params[p]=u},Z=U(e);for(let p of h){let{name:u,schema:L,type:E}=p,R=f[E](u);if(t||R!==void 0){let T=yield L.safeParseAsync(R);if(!T.success)throw new y(`Zodios: Invalid ${E} parameter '${u}'`,n,R,T.error);Z&&c[E](u,T.data);}}return d}):void 0,response:j(o)?(i,n,s)=>l(null,null,function*(){var d,f,c,Z;let h=g(i,n.method,n.url);if(!h)throw new Error(`No endpoint found for ${n.method} ${n.url}`);if((f=(d=s.headers)==null?void 0:d["content-type"])!=null&&f.includes("application/json")||(Z=(c=s.headers)==null?void 0:c["content-type"])!=null&&Z.includes("application/vnd.api+json")){let p=yield h.response.safeParseAsync(s.data);if(!p.success)throw new y(`Zodios: Invalid response from endpoint '${h.method} ${h.path}'
status: ${s.status} ${s.statusText}
cause:
${p.error.message}
received:
${JSON.stringify(s.data,null,2)}`,n,s.data,p.error);j(e)&&(s.data=p.data);}return s}):void 0}}var m=class{constructor(e,t){this.plugins=[];this.key=`${e}-${t}`;}indexOf(e){return this.plugins.findIndex(t=>(t==null?void 0:t.name)===e)}use(e){if(e.name){let t=this.indexOf(e.name);if(t!==-1)return this.plugins[t]=e,{key:this.key,value:t}}return this.plugins.push(e),{key:this.key,value:this.plugins.length-1}}eject(e){if(typeof e=="string"){let t=this.indexOf(e);if(t===-1)throw new Error(`Plugin with name '${e}' not found`);this.plugins[t]=void 0;}else {if(e.key!==this.key)throw new Error(`Plugin with key '${e.key}' is not registered for endpoint '${this.key}'`);this.plugins[e.value]=void 0;}}interceptRequest(e,t){return l(this,null,function*(){let i=t;for(let n of this.plugins)n!=null&&n.request&&(i=yield n.request(e,i));return i})}interceptResponse(e,t,i){return l(this,null,function*(){let n=i;for(let s=this.plugins.length-1;s>=0;s--){let h=this.plugins[s];h&&(n=n.then(h!=null&&h.response?d=>h.response(e,t,d):void 0,h!=null&&h.error?d=>h.error(e,t,d):void 0));}return n})}count(){return this.plugins.reduce((e,t)=>t?e+1:e,0)}};function P(o){let e=new Set;for(let i of o){let n=`${i.method} ${i.path}`;if(e.has(n))throw new Error(`Zodios: Duplicate path '${n}'`);e.add(n);}let t=new Set;for(let i of o)if(i.alias){if(t.has(i.alias))throw new Error(`Zodios: Duplicate alias '${i.alias}'`);t.add(i.alias);}for(let i of o)if(i.parameters&&i.parameters.filter(s=>s.type==="Body").length>1)throw new Error(`Zodios: Multiple body parameters in endpoint '${i.path}'`)}function H(o){return P(o),o}function oe(o){return o}function ie(){return new q([])}var q=class o{constructor(e){this.params=e;}addParameter(e,t,i){return new o([...this.params,{name:e,type:t,description:i.description,schema:i}])}addParameters(e,t){let i=Object.keys(t).map(n=>({name:n,type:e,description:t[n].description,schema:t[n]}));return new o([...this.params,...i])}addBody(e){return this.addParameter("body","Body",e)}addQuery(e,t){return this.addParameter(e,"Query",t)}addPath(e,t){return this.addParameter(e,"Path",t)}addHeader(e,t){return this.addParameter(e,"Header",t)}addQueries(e){return this.addParameters("Query",e)}addPaths(e){return this.addParameters("Path",e)}addHeaders(e){return this.addParameters("Header",e)}build(){return this.params}};function ne(o){return o}function se(o){return o}var A=class{constructor(e){this.api=e;}addEndpoint(e){return this.api.length===0?(this.api=[e],this):(this.api=[...this.api,e],this)}build(){return P(this.api),this.api}};function re(o){return o?new A([o]):new A([])}function ae(o,e){let t=k(o);return H([{method:"get",path:`/${o}s`,alias:`get${t}s`,description:`Get all ${o}s`,response:te.array(e)},{method:"get",path:`/${o}s/:id`,alias:`get${t}`,description:`Get a ${o}`,response:e},{method:"post",path:`/${o}s`,alias:`create${t}`,description:`Create a ${o}`,parameters:[{name:"body",type:"Body",description:"The object to create",schema:e.partial()}],response:e},{method:"put",path:`/${o}s/:id`,alias:`update${t}`,description:`Update a ${o}`,parameters:[{name:"body",type:"Body",description:"The object to update",schema:e}],response:e},{method:"patch",path:`/${o}s/:id`,alias:`patch${t}`,description:`Patch a ${o}`,parameters:[{name:"body",type:"Body",description:"The object to patch",schema:e.partial()}],response:e},{method:"delete",path:`/${o}s/:id`,alias:`delete${t}`,description:`Delete a ${o}`,response:e}])}function de(o){return o.endsWith("/")?o.slice(0,-1):o}function F(o,e){return e.map(t=>a(r({},t),{path:de(`${o}${t.path}`)}))}function pe(o){return Object.keys(o).flatMap(e=>F(e,o[e]))}var M=class{constructor(e,t,i){this.endpointPlugins=new Map;let n;if(!e)throw Array.isArray(t)?new Error("Zodios: missing base url"):new Error("Zodios: missing api description");let s;if(typeof e=="string"&&Array.isArray(t))s=e,this.api=t,n=i||{};else if(Array.isArray(e)&&!Array.isArray(t))this.api=e,n=t||{};else throw new Error("Zodios: api must be an array");P(this.api),this.options=r({validate:true,transform:true,sendDefaults:false},n),this.options.axiosInstance?this.axiosInstance=this.options.axiosInstance:this.axiosInstance=ue.create(r({},this.options.axiosConfig)),s&&(this.axiosInstance.defaults.baseURL=s),this.injectAliasEndpoints(),this.initPlugins(),[true,"all","request","response"].includes(this.options.validate)&&this.use(B(this.options));}initPlugins(){this.endpointPlugins.set("any-any",new m("any","any")),this.api.forEach(e=>{let t=new m(e.method,e.path);switch(e.requestFormat){case "binary":t.use(x("Content-Type","application/octet-stream"));break;case "form-data":t.use(w());break;case "form-url":t.use(D());break;case "text":t.use(x("Content-Type","text/plain"));break}this.endpointPlugins.set(`${e.method}-${e.path}`,t);});}getAnyEndpointPlugins(){return this.endpointPlugins.get("any-any")}findAliasEndpointPlugins(e){let t=this.api.find(i=>i.alias===e);if(t)return this.endpointPlugins.get(`${t.method}-${t.path}`)}findEndpointPlugins(e,t){return this.endpointPlugins.get(`${e}-${t}`)}get baseURL(){return this.axiosInstance.defaults.baseURL}get axios(){return this.axiosInstance}use(...e){if(typeof e[0]=="object")return this.getAnyEndpointPlugins().use(e[0]);if(typeof e[0]=="string"&&typeof e[1]=="object"){let t=this.findAliasEndpointPlugins(e[0]);if(!t)throw new Error(`Zodios: no alias '${e[0]}' found to register plugin`);return t.use(e[1])}else if(typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="object"){let t=this.findEndpointPlugins(e[0],e[1]);if(!t)throw new Error(`Zodios: no endpoint '${e[0]} ${e[1]}' found to register plugin`);return t.use(e[2])}throw new Error("Zodios: invalid plugin registration")}eject(e){var t;if(typeof e=="string"){this.getAnyEndpointPlugins().eject(e);return}(t=this.endpointPlugins.get(e.key))==null||t.eject(e);}injectAliasEndpoints(){this.api.forEach(e=>{e.alias&&(["post","put","patch","delete"].includes(e.method)?this[e.alias]=(t,i)=>this.request(a(r({},i),{method:e.method,url:e.path,data:t})):this[e.alias]=t=>this.request(a(r({},t),{method:e.method,url:e.path})));});}request(e){return l(this,null,function*(){let t=e,i=this.getAnyEndpointPlugins(),n=this.findEndpointPlugins(t.method,t.url);t=yield i.interceptRequest(this.api,t),n&&(t=yield n.interceptRequest(this.api,t));let s=this.axiosInstance.request(a(r({},b(t,["params","queries"])),{url:C(t),params:t.queries}));return n&&(s=n.interceptResponse(this.api,t,s)),s=i.interceptResponse(this.api,t,s),(yield s).data})}get(i){return l(this,arguments,function*(e,...[t]){return this.request(a(r({},t),{method:"get",url:e}))})}post(n,s){return l(this,arguments,function*(e,t,...[i]){return this.request(a(r({},i),{method:"post",url:e,data:t}))})}put(n,s){return l(this,arguments,function*(e,t,...[i]){return this.request(a(r({},i),{method:"put",url:e,data:t}))})}patch(n,s){return l(this,arguments,function*(e,t,...[i]){return this.request(a(r({},i),{method:"patch",url:e,data:t}))})}delete(n,s){return l(this,arguments,function*(e,t,...[i]){return this.request(a(r({},i),{method:"delete",url:e,data:t}))})}},he=M;function Q(o,e){if(o instanceof AxiosError||o&&typeof o=="object"&&"isAxiosError"in o){let t=o;if(t.response){let i=e(t);if(i)return i.some(n=>n.schema.safeParse(t.response.data).success)}}return  false}function fe(o,e,t,i){return Q(i,n=>S(o,e,t,n))}function ye(o,e,t){return Q(t,i=>z(o,e,i))}export{he as Zodios,y as ZodiosError,re as apiBuilder,P as checkApi,w as formDataPlugin,D as formURLPlugin,x as headerPlugin,ye as isErrorFromAlias,fe as isErrorFromPath,H as makeApi,ae as makeCrudApi,se as makeEndpoint,ne as makeErrors,oe as makeParameters,pe as mergeApis,ie as parametersBuilder,F as prefixApi,B as zodValidationPlugin};